<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>canvas</title>
    <style>
        body {
            text-align: center;
        }
    </style>
</head>
<body>
<canvas id="canvasSrc" style="border: 1px solid #aaa;margin: 0 auto;">
    您的浏览器不支持canvas，请使用较新的浏览器查看
</canvas>
<canvas id="canvasDest" style="border: 1px solid #aaa;margin: 0 auto;">
    您的浏览器不支持canvas，请使用较新的浏览器查看
</canvas>


<div>
    <button id="black-white">黑白</button>
    <button id="grey">灰色</button>
</div>
<script>

    window.onload = init;
    function init() {
        var canvasSrc = document.getElementById('canvasSrc');
        var contextSrc = canvasSrc.getContext('2d');
        var canvasDest = document.getElementById('canvasDest');
        var contextDest = canvasDest.getContext('2d');

        var blackWhite = document.getElementById('black-white');
        var grey = document.getElementById('grey');

        var img = new Image();
        img.src = "./images/rainbow.jpeg";
        img.onload = function(){
            canvasSrc.width = img.width;
            canvasSrc.height = img.height;
            contextSrc.drawImage(img,0,0);
        };


        blackWhite.onclick = function(){
            var imgData = contextSrc.getImageData(0,0,canvasSrc.width,canvasSrc.height);
            var pixelData = imgData.data;
            var len = pixelData.length;
            for(var i = 0; i < len; i++){
//                var r = pixelData[i*4];
//                var g = pixelData[i*4+1];
//                var b = pixelData[i*4+2];
//                var a = pixelData[i*4+3];
                if(pixelData[i*4]>255/2){
                    pixelData[i*4] = 255;
                }else{
                    pixelData[i*4] = 0;
                }

                if(pixelData[i*4]>255/2){
                    pixelData[i*4+1] = 255;
                }else{
                    pixelData[i*4+1] = 0;
                }

                if(pixelData[i*4]>255/2){
                    pixelData[i*4+2] = 255;
                }else{
                    pixelData[i*4+2] = 0;
                }
            }
            canvasDest.width = canvasSrc.width;
            canvasDest.height = canvasSrc.height;
            contextDest.putImageData(imgData,0,0,0,0,canvasDest.width,canvasDest.height);
        };

        grey.addEventListener("click",function(){
            var imgData = contextSrc.getImageData(0,0,canvasSrc.width,canvasSrc.height);
            var pixelData = imgData.data;
            var len = pixelData.length;
            for(var i = 0; i < len; i++){
                var r = pixelData[i*4];
                var g = pixelData[i*4+1];
                var b = pixelData[i*4+2];
                var a = pixelData[i*4+3];

                var grey = r * 0.3 + g * 0.59 + b * 0.11;
                pixelData[i*4] = grey;
                pixelData[i*4+1] = grey;
                pixelData[i*4+2] = grey;

            }
            canvasDest.width = canvasSrc.width;
            canvasDest.height = canvasSrc.height;
            contextDest.putImageData(imgData,0,0,0,0,canvasDest.width,canvasDest.height);
        },false);


    }
</script>
</body>
</html>